{include file="public/header" /}
<style>
	.reason{display:none;}
</style>
				<div class="main-content">
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>

						{$crumbs.one}<!-- .breadcrumb -->

						<div class="nav-search" id="nav-search">
							<form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
									<i class="icon-search nav-search-icon"></i>
								</span>
							</form>
						</div><!-- #nav-search -->
					</div>

					<div class="page-content">
						{$crumbs.two}<!-- /.page-header -->

						<div class="row sl">
							<div class="col-xs-12 get" >
								<!-- PAGE CONTENT BEGINS -->
								<div class="row">
									<div class="col-xs-12 ">
										<div class="table-responsive">
											<table id="sample-table-2"  class="table table-striped table-bordered table-hover">
												<thead>
													<tr>
														<th>众筹标题</th>
														<th>内容</th>
														<th>众筹资金</th>
														<th>众筹天数</th>
														<th>姓名</th>
														<th>电话</th>
														<th>图片</th>
														<th>申请人</th>
														<th>审核状态</th>
														<th>审核</th>
														<th >查看详情</th>
													</tr>
												</thead>

												<tbody>
												{if condition="!empty($AllCollect)"}
												{volist name="AllCollect" id="vo" key="k" }
													<tr>
														<td>{$vo.title}</td>
														<td>{$vo.content}</td>
														<td>{$vo.capital}</td>
														<td>{$vo.days}</td>
														<td>{$vo.userName}</td>
														<td>{$vo.mobile}</td>
														<td>{$vo.avatar_image}</td>
														<td>{$vo.tu_id}</td>
														<td>{$vo.show_status}</td>
														<td>
															<button class="btn btn-minier btn-yellow status one_status one{$vo.id}"  {if condition="$vo.status==1"} disabled{/if} id="one_status" data-id="{$vo.id}" data-status="1">同意</button>
															<button class="two_status btn btn-minier btn-yellow status two_status two{$vo.id}" {if condition="$vo.status==0"}disabled{/if} data-rel="tooltip"  target="prompt" id="two_status" data-id="{$vo.id}" data-status="0"  >不同意</button>
															<button class="btn btn-minier btn-yellow status three_status three{$vo.id}" {if condition="$vo.status==2"} disabled {/if}  id="three_status" data-id="{$vo.id}" data-status="2">待审核</button>
															<div style="position:relative; z-index:1050;" class="reason">
																<div style="position:absolute;left:0;top:0;">
																	<div><h2>审核不通过理由：</h2></div>
																	<div><textarea name="yj" cols="20" rows="5"></textarea></div>
																	<div>
																		<button class="btn scc{$vo.id} scc btn-minier btn-yellow status " data-rel="tooltip" data-id="{$vo.id}" target="prompt" id="scc" data-status="0">确认</button>
																		<button class="btn err btn-minier btn-yellow status " data-rel="tooltip"  target="prompt" id="err" data-status="0">取消</button>
																	</div>
																</div>
															</div>
														</td>
														<td>
															<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
																<a href="#modal-table" no='{$vo.id}' data-userid='{$vo.tu_id}' data-toggle="modal" class="tooltip-success select" data-rel="tooltip"  target="prompt" title="详细信息">
																	<span class="blue">
																		<i class="icon-eye-open bigger-180"></i>
																	</span>
																</a>															
															</div>	
															<div class="visible-xs visible-sm hidden-md hidden-lg">
																<div class="inline position-relative">
																	<button class="btn btn-minier btn-yellow dropdown-toggle" data-toggle="dropdown">
																		<i class="icon-caret-down icon-only bigger-120"></i>
																	</button>

																	<ul class="dropdown-menu dropdown-only-icon dropdown-yellow pull-right dropdown-caret dropdown-close">
																		<li>
																			<a href="/admin/adminuser/edit?id={$vo.id}" class="tooltip-info" data-rel="tooltip" title="修改">
																				<span class="blue">
																					<i class="icon-edit bigger-120"></i>
																				</span>
																			</a>
																		</li>

																		<li>
																			<a href="/admin/adminuser/del?id={$vo.id}" class="tooltip-success" onclick="return confirm('即将删除该记录，操作不可恢复，确定吗？')" target="prompt" data-rel="tooltip" title="删除">
																				<span class="green">
																					<i class="icon-trash bigger-120"></i>
																				</span>
																			</a>
																		</li>
																	</ul>
																</div>
															</div>
														</td>
													</tr>
													
												{/volist}
												{else /}
												<tr>
													<td>无</td>
												</tr>
												{/if}
												</tbody>
											</table>
										</div><!-- /.table-responsive -->
									</div><!-- /span -->
								</div><!-- /row -->

								<div class="hr hr-18 dotted hr-double"></div>
								
								
								
								<div class="hr hr-18 dotted hr-double"></div>
								<div  class="modal fade group_show" tabindex="-1">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header no-padding">
												<div class="table-header" style="text-align:center;">
													<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
														<span class="white">&times;</span>
													</button>
													众筹信息
												</div>
											</div>

											<div class="modal-body no-padding">
												<table class="table table-striped table-bordered table-hover no-margin-bottom no-border-top">

													<tbody class="by">
														
													</tbody>
												</table>
											</div>

											<div class="modal-footer no-margin-top u_page">
												<button class="btn btn-sm btn-danger pull-left" data-dismiss="modal">
													<i class="icon-remove"></i>
													Close
												</button>

												
											</div>
										</div><!-- /.modal-content -->
									</div><!-- /.modal-dialog -->
								</div><!-- PAGE CONTENT ENDS -->
						</div><!-- /.row -->
					</div>
					</div><!-- /.page-content -->
				</div><!-- /.main-content -->

		
	{include file="public/footer" /}
	<div style="opacity:0.5;background-color:#e4e6e9;bottom:0;left:0;position:fixed;right:0;top:0;z-index:1030;display:none;" class="op"></div>
		<!-- basic scripts -->


		<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

		<!--[if !IE]> -->
		<script type="text/javascript">
			window.jQuery || document.write("<script src='/public/effect/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script>
<!--
<script>
$('.select').click(function(){
	$('body').addClass("modal-open");
	$('.sl').find('#modal-table').addClass("in");
	$('.sl').find('#modal-table').attr('aria-hidden',"false");
	$('.sl').find('#modal-table').css('display',"block");
	$('body').append('<div class="modal-backdrop fade in"></div>');
	//$('.sl').find('#modal-table').css({aria-hidden:"false",display:"block"});
});

</script>
-->
		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="/public/effect/assets/js/bootstrap.min.js"></script>
		<script src="/public/effect/assets/js/typeahead-bs2.min.js"></script>

		<!-- page specific plugin scripts -->

		<script src="/public/effect/assets/js/jquery.dataTables.min.js"></script>
		<script src="/public/effect/assets/js/jquery.dataTables.bootstrap.js"></script>

		<!-- ace scripts -->

		<script src="/public/effect/assets/js/ace-elements.min.js"></script>
		<script src="/public/effect/assets/js/ace.min.js"></script>

		<!-- inline scripts related to this page -->

		<script type="text/javascript">
			$('.select').click(function (event){
			$('.group_show').attr('id','modal-table')
				$(".by").empty();
				$.ajax({
				   type: "POST",
				   url: "/admin/appcollect/get_collect_info",
				   data: "collect_id="+$(this).attr('no')+"&tu_id="+$(this).data('userid'),
				   success: function(msg){
					if(msg.code){
						var li='';
						//$.each(msg.msg,function(index,array){
							li+='<tr><td>众筹标题：</td><td>'+msg.msg.title+'</td></tr>';
							li+='<tr><td>众筹详细介绍：</td><td><div style="overflow:auto;width:450px;height:170px;">'+msg.msg.content+'</div></td></tr>';
							li+='<tr><td>众筹总资金：</td><td>'+msg.msg.capital+'</td></tr>';
							li+='<tr><td>众筹已筹资金：</td><td>'+msg.msg.contribution+'</td></tr>';
							li+='<tr><td>众筹者姓名：</td><td>'+msg.msg.userName+'</td></tr>';
							li+='<tr><td>众筹者电话号码：</td><td>'+msg.msg.mobile+'</td></tr>';
							li+='<tr><td>众筹天数：</td><td>'+msg.msg.days+'天</td></tr>';
							li+='<tr><td>审核状态</td><td style="color:blue;">'+msg.msg.show_status+'</td></tr>';	
							if(msg.msg.reason!=''){
								li+='<tr><td>不通过原因：</td><td>'+msg.msg.reason+'</td></tr>';
							}								
							li+='<tr><td colspan="2" align="center">申请用户信息</td></tr>';
							li+='<tr><td>申请人ID：</td><td>'+msg.msg.tu_id+'</td></tr>';
							li+='<tr><td>申请人昵称：</td><td>'+msg.msg.nickname+'</td></tr>';
							li+='<tr><td>申请人地址：</td><td>'+msg.msg.address+'</td></tr>';
						//});
						var page=msg.page;												
	
						 $('.by').html(li);
						 $('.u_page').html('');
				   }else{
						layer.alert(msg.msg,{icon: 5});
				   }
					
				   }
				});
			});
			$('.two_status').on("click",function (){
				$(this).nextAll('.reason').css('display','block');
				$('.op').css('display','block');	
			});
			$('.scc').click(function(e){
				var id=$(this).data('id');
				var status=$(this).data('status');
				var one='one'+$(this).data('id');
				var two='two'+$(this).data('id');
				var three='three'+$(this).data('id');
					$.ajax({
					   type: "POST",
					   url: "/admin/appcollect/change_stauts",
					   data: "status="+status+'&id='+id+'&reason='+$(this).parent().prev().children().val(),
					   success: function(msg){
						if(msg){
							$('.'+one).removeAttr("disabled");
							$('.'+one).removeClass("disabled");
							$('.'+three).removeAttr("disabled");
							$('.'+three).removeClass("disabled");
							$('.'+two).addClass('disabled');
							$('.reason').css('display','none');
							$('.op').css('display','none');
							layer.alert('更新成功',{icon: 1});
					   }else{
							$('.reason').css('display','none');
							$('.op').css('display','none');
							layer.alert('更新失败',{icon: 5});
					   }
						
					   }
					});
					e.stopPropagation();
				});	
			$('.one_status').click(function (){
				var one='one'+$(this).data('id');
				var two='two'+$(this).next().data('id');
				var three='three'+$(this).nextAll('.three_status').data('id');
				$.ajax({
				   type: "POST",
				   url: "/admin/appcollect/change_stauts",
				   data: "status="+$(this).data('status')+'&id='+$(this).data('id'),
				   success: function(msg){
					if(msg){	
						
						$('.'+two).removeAttr("disabled");
						$('.'+two).removeClass("disabled");
						$('.'+three).removeAttr("disabled");
						$('.'+three).removeClass("disabled");
						$('.'+one).addClass('disabled');
						layer.alert('更新成功',{icon: 1});
				   }else{
						layer.alert('更新失败',{icon: 5});
				   }
				   }
				});
				
			});
			
			$('.err').click(function(){
				$('.reason').css('display','none');
				$('.op').css('display','none');
			});
			$('.op').click(function(){
				$('.op').css('display','none');
				$('.reason').css('display','none');
			});
			$('.three_status').click(function (){
				var one='one'+$(this).data('id');
				var two='two'+$(this).prev().data('id');
				var three='three'+$(this).prevAll('.one_status').data('id');
				$.ajax({
				   type: "POST",
				   url: "/admin/appcollect/change_stauts",
				   data: "status="+$(this).data('status')+'&id='+$(this).data('id'),
				   success: function(msg){
					if(msg){
						$('.'+two).removeAttr("disabled");
						$('.'+two).removeClass("disabled");
						$('.'+one).removeAttr("disabled");
						$('.'+one).removeClass("disabled");
						$('.'+three).addClass('disabled');
						layer.alert('更新成功',{icon: 1});
				   }else{
						layer.alert('更新失败',{icon: 5});
				   }
					
				   }
				});
				
			});
			jQuery(function($) {
				var oTable1 = $('#sample-table-2').dataTable( {
				"aoColumns": [
			      { "bSortable": false },
			      null, null,null, null, null,
				  { "bSortable": false }
				] } );
				
				
				$('table th input:checkbox').on('click' , function(){
					var that = this;
					$(this).closest('table').find('tr > td:first-child input:checkbox')
					.each(function(){
						this.checked = that.checked;
						$(this).closest('tr').toggleClass('selected');
					});
						
				});
			
			
				$('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});
				function tooltip_placement(context, source) {
					var $source = $(source);
					var $parent = $source.closest('table')
					var off1 = $parent.offset();
					var w1 = $parent.width();
			
					var off2 = $source.offset();
					var w2 = $source.width();
			
					if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
					return 'left';
				}
			})
		</script>
								